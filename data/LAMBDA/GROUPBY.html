<h2>语法</h2>
<p>
  <strong>GROUPBY</strong
  >(分组数组,值数组,函数,[行标题],[总计小计],[排序依据],[筛选数组],[层次结构])<br />
  <strong>GROUPBY</strong
  >(row_fieldsvalues，function，[field_headers]，[total_depth]，[sort_order]，[filter_array]，[field_relationship])
</p>
<h3>参数</h3>
<ol>
  <li>
    <p>分组数组 row_array：用于分组的行字段数组。</p>
  </li>
  <li>
    <p>值数组 value_array：需要聚合计算的值数组。</p>
  </li>
  <li>
    <p>函数 function：应用于每个分组的聚合函数。</p>
  </li>
  <li>
    <p>行标题 field_headers：指定行标题显示方式。</p>
    <ul>
      <li>默认自动判定。</li>
      <li>0：否。</li>
      <li>1：是，不显示。</li>
      <li>2：否，但生成。</li>
      <li>3：是并显示。</li>
    </ul>
  </li>
  <li>
    <p>总计小计 total_depth：总计和小计的显示方式。</p>
    <ul>
      <li>默认自动判定。</li>
      <li>0：不显示。</li>
      <li>1：总计。</li>
      <li>2：总计和小计。</li>
      <li>-1： 顶部总计。</li>
      <li>-2： 顶部总计和小计。</li>
    </ul>
  </li>
  <li>
    <p>排序依据 sort_order: 排序依据。</p>
    <ul>
      <li>正数: 按数值对应的列正序排序。</li>
      <li>负数: 按数值对应的列倒序排序。</li>
      <li>数组: 按数组中数值对应的列排序，优先级按值顺序。</li>
    </ul>
  </li>
  <li>
    <p>
      筛选数组
      filter_array：用于筛选数据的条件数组，与分组数组长度一致，且是单列。
    </p>
  </li>
  <li>
    <p>
      层次结构 field_relationship: 当分组数组为多列时生效，参考透视表的表结构。
    </p>
    <ul>
      <li>0：层次结构</li>
      <li>1：表结构</li>
    </ul>
  </li>
</ol>
<h2>概述</h2>
<p>函数按分组数组传递值计算，返回分组聚合统计结果。</p>
<h3>补充</h3>
<ol>
  <li>分组数组可以存在多列，行内相同则分为一组。</li>
  <li>值数组存在多列时，对应的函数数量应该与列数相同或为一个。</li>
  <li>多个聚合项使用HSTACK、VSTACK等返回数组存储的函数调用。</li>
  <li>使用LAMBDA传参时：参数1为所在分组数据，参数2为所在列数据。</li>
</ol>
<h3>常见错误</h3>
<ol>
  <li>每个函数返回的结果要是一个值，不能是数组，否则因无法展开报错。</li>
</ol>
<h2>示例</h2>
<h3>示例数据 A</h3>

<table>
  <thead>
    <tr>
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>部门</td>
      <td>姓名</td>
      <td>性别</td>
      <td>销售数量</td>
      <td>销售金额</td>
    </tr>
    <tr>
      <td>2</td>
      <td>魏国</td>
      <td>张辽</td>
      <td>男</td>
      <td>79</td>
      <td>9460</td>
    </tr>
    <tr>
      <td>3</td>
      <td>蜀国</td>
      <td>赵云</td>
      <td>男</td>
      <td>72</td>
      <td>8580</td>
    </tr>
    <tr>
      <td>4</td>
      <td>吴国</td>
      <td>孙尚香</td>
      <td>女</td>
      <td>102</td>
      <td>12200</td>
    </tr>
    <tr>
      <td>5</td>
      <td>吴国</td>
      <td>甘宁</td>
      <td>男</td>
      <td>56</td>
      <td>6760</td>
    </tr>
    <tr>
      <td>6</td>
      <td>魏国</td>
      <td>夏侯惇</td>
      <td>男</td>
      <td>117</td>
      <td>13980</td>
    </tr>
    <tr>
      <td>7</td>
      <td>魏国</td>
      <td>郭嘉</td>
      <td>男</td>
      <td>76</td>
      <td>9060</td>
    </tr>
    <tr>
      <td>8</td>
      <td>蜀国</td>
      <td>刘备</td>
      <td>男</td>
      <td>57</td>
      <td>6840</td>
    </tr>
    <tr>
      <td>9</td>
      <td>魏国</td>
      <td>甄姬</td>
      <td>女</td>
      <td>114</td>
      <td>13720</td>
    </tr>
    <tr>
      <td>10</td>
      <td>蜀国</td>
      <td>张飞</td>
      <td>男</td>
      <td>57</td>
      <td>6840</td>
    </tr>
    <tr>
      <td>11</td>
      <td>魏国</td>
      <td>曹操</td>
      <td>男</td>
      <td>111</td>
      <td>13260</td>
    </tr>
    <tr>
      <td>12</td>
      <td>蜀国</td>
      <td>关羽</td>
      <td>男</td>
      <td>55</td>
      <td>6580</td>
    </tr>
    <tr>
      <td>13</td>
      <td>蜀国</td>
      <td>诸葛亮</td>
      <td>男</td>
      <td>61</td>
      <td>7280</td>
    </tr>
    <tr>
      <td>14</td>
      <td>魏国</td>
      <td>司马懿</td>
      <td>男</td>
      <td>91</td>
      <td>10960</td>
    </tr>
    <tr>
      <td>15</td>
      <td>吴国</td>
      <td>孙权</td>
      <td>男</td>
      <td>58</td>
      <td>6900</td>
    </tr>
  </tbody>
</table>
<h4>示例 A_1</h4>
<pre><code class="language-excel code-highlight"><span class="code-line line-number" line="1">GROUPBY(A1:A15,D1:D15,SUM,3)
</span></code></pre>

<table>
  <thead>
    <tr>
      <th>组 1</th>
      <th>SUM</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>魏国</td>
      <td>79</td>
    </tr>
    <tr>
      <td>魏国</td>
      <td>117</td>
    </tr>
    <tr>
      <td>魏国</td>
      <td>76</td>
    </tr>
    <tr>
      <td>魏国</td>
      <td>114</td>
    </tr>
    <tr>
      <td>魏国</td>
      <td>111</td>
    </tr>
    <tr>
      <td>魏国</td>
      <td>91</td>
    </tr>
    <tr>
      <td>合计</td>
      <td>588</td>
    </tr>
  </tbody>
</table>

<table>
  <thead>
    <tr>
      <th>组 2</th>
      <th>SUM</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>蜀国</td>
      <td>72</td>
    </tr>
    <tr>
      <td>蜀国</td>
      <td>57</td>
    </tr>
    <tr>
      <td>蜀国</td>
      <td>57</td>
    </tr>
    <tr>
      <td>蜀国</td>
      <td>55</td>
    </tr>
    <tr>
      <td>蜀国</td>
      <td>61</td>
    </tr>
    <tr>
      <td>合计</td>
      <td>302</td>
    </tr>
  </tbody>
</table>

<table>
  <thead>
    <tr>
      <th>组 3</th>
      <th>SUM</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>吴国</td>
      <td>102</td>
    </tr>
    <tr>
      <td>吴国</td>
      <td>56</td>
    </tr>
    <tr>
      <td>吴国</td>
      <td>58</td>
    </tr>
    <tr>
      <td>合计</td>
      <td>216</td>
    </tr>
  </tbody>
</table>
<p>组合排序后</p>

<table>
  <thead>
    <tr>
      <th>部门</th>
      <th>销售数量</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>蜀国</td>
      <td>302</td>
    </tr>
    <tr>
      <td>魏国</td>
      <td>588</td>
    </tr>
    <tr>
      <td>吴国</td>
      <td>216</td>
    </tr>
    <tr>
      <td>总计</td>
      <td>1106</td>
    </tr>
  </tbody>
</table>
<h4>示例 A_2：多列分组依据</h4>
<pre><code class="language-excel code-highlight"><span class="code-line line-number" line="1">GROUPBY(HSTACK(A1:A15,C1:C15),D1:E15,SUM,3)
</span></code></pre>

<table>
  <thead>
    <tr>
      <th>返回</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td></td>
      <td>部门</td>
      <td>性别</td>
      <td>销售数量</td>
      <td>销售金额</td>
    </tr>
    <tr>
      <td></td>
      <td>蜀国</td>
      <td>男</td>
      <td>302</td>
      <td>36120</td>
    </tr>
    <tr>
      <td></td>
      <td>魏国</td>
      <td>男</td>
      <td>474</td>
      <td>56720</td>
    </tr>
    <tr>
      <td></td>
      <td>魏国</td>
      <td>女</td>
      <td>114</td>
      <td>13720</td>
    </tr>
    <tr>
      <td></td>
      <td>吴国</td>
      <td>男</td>
      <td>114</td>
      <td>13660</td>
    </tr>
    <tr>
      <td></td>
      <td>吴国</td>
      <td>女</td>
      <td>102</td>
      <td>12200</td>
    </tr>
    <tr>
      <td></td>
      <td>总计</td>
      <td></td>
      <td>1106</td>
      <td>132420</td>
    </tr>
  </tbody>
</table>
<h4>示例 A_3：多列函数</h4>
<pre><code class="language-excel code-highlight"><span class="code-line line-number" line="1">GROUPBY(HSTACK(A2:A15,C2:C15),D2:E15,HSTACK(SUM,MAX),,0)
</span></code></pre>

<table>
  <thead>
    <tr>
      <th>返回</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td></td>
      <td></td>
      <td></td>
      <td>SUM</td>
      <td>MAX</td>
    </tr>
    <tr>
      <td></td>
      <td>蜀国</td>
      <td>男</td>
      <td>302</td>
      <td>8580</td>
    </tr>
    <tr>
      <td></td>
      <td>魏国</td>
      <td>男</td>
      <td>474</td>
      <td>13980</td>
    </tr>
    <tr>
      <td></td>
      <td>魏国</td>
      <td>女</td>
      <td>114</td>
      <td>13720</td>
    </tr>
    <tr>
      <td></td>
      <td>吴国</td>
      <td>男</td>
      <td>114</td>
      <td>6900</td>
    </tr>
    <tr>
      <td></td>
      <td>吴国</td>
      <td>女</td>
      <td>102</td>
      <td>12200</td>
    </tr>
  </tbody>
</table>
<h2>致谢</h2>
<p>
  本篇在博主 <strong>超人</strong>(shaowu459) 基础上进行修改。<br />
  示例数据因篇幅和难度问题只选择部分，完整示例数据请访问原文链接。<br />
  原文链接：<a href="https://club.excelhome.net/thread-1687101-1-1.html"
    >https://club.excelhome.net/thread-1687101-1-1.html</a
  >
</p>
